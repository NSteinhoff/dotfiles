#!/bin/bash
############################
# install
# This script creates symlinks from the home directory to any desired dotfiles in ~/dotfiles
############################
dir="$HOME/dotfiles"

########## Installing system packages
echo -e "\n\n"
echo ">>>>>>>>>>>>>>>"
echo "Installing system packages..."

sudo apt install $(cat $dir/extras/packages)


##### Installing Python
install_python () {
    echo -e "\n\n"
    echo ">>>>>>>>>>>>>>>"
    echo "Installing python..."

    $dir/extras/python
}
# install_python


########## ZSH
install_zsh() {
    echo "Making Zsh default shell"
    sudo chsh -s `which zsh`
    echo "Installing oh-my-zsh"
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
}
# install_zsh


########## Dotfiles in HOME
echo -e "\n\n"
echo ">>>>>>>>>>>>>>>"
echo "Installing dotfiles..."
bkpdir="$HOME/.dotfiles_bkp"
files=(\
    bash_aliases \
    cider.edn \
    config/alacritty/alacritty.yml \
    config/nvim \
    config/sxhkd/sxhkdrc \
    clojure/deps.edn \
    crawlrc \
    ctags \
    ctags.d \
    git_template \
    gitconfig \
    gitignore \
    inputrc \
    scalafmt.conf \
    screenrc \
    tmux.conf \
    vim \
    vimrc \
    gvimrc \
    zshrc \
)


# move any existing dotfiles in homedir to dotfiles_old directory,
# then create symlinks from the homedir to any files in the
# ~/dotfiles directory specified in $files
for file in ${files[*]}; do
    target="$dir/$file"
    linkname="$HOME/.$file"
    linkdir="${linkname%/*}"
    echo "$file:"
    if [ -L "$linkname" ]; then
        echo -e "\tRemoving old symlink."
        rm "$linkname"
    fi
    if [ -f "$linkname" ] || [ -d "$linkname" ]; then
        echo -e "\tBacking-up existing file."
        mkdir -p "$bkpdir/${file%/*}"
        mv -v "$linkname" "$bkpdir/$file"
    fi
    [ -d "$linkdir" ] || mkdir -p "$linkdir"
    echo -e "\tCreating symlink: $(ln -v -s $target $linkname)"
done

# Init and update the plugins tracked as submodules
pushd "$dir"
git submodule update --init --recursive
popd

### Download git prompt script
# curl -XGET "https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh" > ~/.git-prompt.sh
