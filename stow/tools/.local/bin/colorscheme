#!/bin/bash
config=$HOME/.config/alacritty/alacritty.toml
colorsd=$HOME/.config/alacritty/colors

available() {
    [[ -z $1 ]] && return 1

    for c in $colors; do
        [[ $c == $1 ]] && return 0
    done

    echo "ERROR: Colorscheme '$1' not found. Please select one of the available colors."

    return 1
}

colors=$(for f in $(ls $colorsd); do echo "${f%%.toml}"; done)
color=$(grep -E "$colorsdir"'/colors/.*.toml"' "$config" | cut -d \" -f 2 | rev | cut -d / -f 1 | rev | cut -d '.' -f 1)

if [[ $1 == -p || $1 == --print ]]; then
    echo "$color"
    exit 0;
fi

if [[ $1 == -l || $1 == --list ]]; then
    for c in $colors; do echo $c; done
    exit 0;
fi

echo "Colorscheme: $color"

[ $# == 1 ] && selected="$1"

if ! available "$selected"; then
    select selected in $colors; do break; done
    ( [ -z $selected ] || [ -z "$REPLY" ] ) && echo "Okay then..." && exit 1
fi

if [[ "$selected" == "$color" ]]; then
    echo "You are already using '$selected'."
    exit 1
fi

echo -e "Setting colors to '$selected'"
sed -i '' -E 's:(colors/)(.*)(.toml):\1'"$selected"'\3:' "$config"
